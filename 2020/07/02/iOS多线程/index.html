<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>iOS多线程 - 覃鹏成的博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="覃鹏成的博客"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="覃鹏成的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="一 常见多线程方案"><meta property="og:type" content="blog"><meta property="og:title" content="iOS多线程"><meta property="og:url" content="https://qpc2015.github.io/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><meta property="og:site_name" content="覃鹏成的博客"><meta property="og:description" content="一 常见多线程方案"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://qpc2015.github.io/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/9aa5-9ddd279cb3f6.png"><meta property="og:image" content="https://qpc2015.github.io/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/45bc-884b-57e2ca90e830.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808172804-ece31806-2815-4687-8cbb-c295ffb2185f.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808217632-d5ea0bcf-7a6c-4877-b3d9-cc8f53d7dd87.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808256309-02287254-a7d0-4c38-86dc-fe580f1718fa.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808393628-05b9c169-6b9d-45c4-ab31-9c4dde9636b8.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808457775-d01fb755-225f-4533-a31a-e62060a9ebda.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808553923-17972075-87d2-472b-b325-748a86dfc748.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808560714-f9d27f8a-204d-40ab-8904-ddfee654f02d.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808616416-1c62d75f-a76f-4e8d-b81e-795156d61fee.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808669285-0eabeac9-f56f-47b5-bcfa-8d7d70cb8518.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808751508-578e82ef-507b-4af9-a5c7-8767318f3205.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808816084-7ab01211-b556-4fb9-b3a3-14ea6a0e7223.png"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808875201-5177f3ca-662a-48dd-9b1b-4111c5107ad5.png"><meta property="article:published_time" content="2020-07-02T03:26:57.000Z"><meta property="article:modified_time" content="2022-07-04T03:41:38.621Z"><meta property="article:author" content="覃鹏成"><meta property="article:tag" content="iOS"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/9aa5-9ddd279cb3f6.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://qpc2015.github.io/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},"headline":"iOS多线程","image":["https://qpc2015.github.io/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/9aa5-9ddd279cb3f6.png","https://qpc2015.github.io/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/45bc-884b-57e2ca90e830.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808172804-ece31806-2815-4687-8cbb-c295ffb2185f.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808217632-d5ea0bcf-7a6c-4877-b3d9-cc8f53d7dd87.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808256309-02287254-a7d0-4c38-86dc-fe580f1718fa.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808393628-05b9c169-6b9d-45c4-ab31-9c4dde9636b8.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808457775-d01fb755-225f-4533-a31a-e62060a9ebda.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808553923-17972075-87d2-472b-b325-748a86dfc748.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808560714-f9d27f8a-204d-40ab-8904-ddfee654f02d.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808616416-1c62d75f-a76f-4e8d-b81e-795156d61fee.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808669285-0eabeac9-f56f-47b5-bcfa-8d7d70cb8518.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808751508-578e82ef-507b-4af9-a5c7-8767318f3205.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808816084-7ab01211-b556-4fb9-b3a3-14ea6a0e7223.png","https://cdn.nlark.com/yuque/0/2021/png/668117/1613808875201-5177f3ca-662a-48dd-9b1b-4111c5107ad5.png"],"datePublished":"2020-07-02T03:26:57.000Z","dateModified":"2022-07-04T03:41:38.621Z","author":{"@type":"Person","name":"覃鹏成"},"publisher":{"@type":"Organization","name":"覃鹏成的博客","logo":{"@type":"ImageObject","url":"https://qpc2015.github.io/img/logo.svg"}},"description":"一 常见多线程方案"}</script><link rel="canonical" href="https://qpc2015.github.io/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="覃鹏成的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-07-02T03:26:57.000Z" title="2020/7/2 上午11:26:57">2020-07-02</time>发表</span><span class="level-item"><time dateTime="2022-07-04T03:41:38.621Z" title="2022/7/4 上午11:41:38">2022-07-04</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/iOS/">iOS</a></span><span class="level-item">23 分钟读完 (大约3379个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">iOS多线程</h1><div class="content"><h3 id="一-常见多线程方案"><a href="#一-常见多线程方案" class="headerlink" title="一 常见多线程方案"></a>一 常见多线程方案</h3><h3 id><a href="#" class="headerlink" title></a><img src="/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/9aa5-9ddd279cb3f6.png" alt="9aa5-9ddd279cb3f6"></h3><span id="more"></span>

<h3 id="二-GCD"><a href="#二-GCD" class="headerlink" title="二 GCD"></a>二 GCD</h3><p><strong>2.1 基础术语</strong></p>
<p>同步和异步主要影响:能不能开启新的线程</p>
<p><strong>同步:</strong>在当前线程中执行任务,不具备开启新线程的能力</p>
<p><strong>异步:</strong>在新线程中执行任务,具备开启新线程的能力</p>
<p>并发和串行的主要影响:任务的执行方式</p>
<p><strong>并发:</strong>多个任务并发(同时)执行</p>
<p><strong>串行:</strong>一个任务执行完毕后,在执行下一个任务</p>
<p><img src="/2020/07/02/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/45bc-884b-57e2ca90e830.png" alt="45bc-884b-57e2ca90e830"></p>
<p><strong>产生死锁:</strong>使用sync函数往当前串行队列中添加任务，会卡住当前的串行队列 </p>
<p><strong>2.2常见使用</strong></p>
<p><strong>2.2.1任务+队列</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 同步执行 + 并发队列</span></span><br><span class="line"><span class="comment"> * 特点：在当前线程中执行任务，不会开启新线程，执行完一个任务，再执行下一个任务。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)syncConCurrent&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);  <span class="comment">// 打印当前线程</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;syncConcurrent---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.hs.queue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">25.088970</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000035b0700</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">25.089089</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] syncConcurrent---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">27.090291</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000035b0700</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">29.090881</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000035b0700</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">31.091210</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000035b0700</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">33.092106</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000035b0700</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">35.093407</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000035b0700</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">37.093798</span>+<span class="number">0800</span> GCD01[<span class="number">2847</span>:<span class="number">134875</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000035b0700</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步执行 + 并发队列</span></span><br><span class="line"><span class="comment"> * 特点：可以开启多个线程，任务交替（同时）执行。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)asyncConcurrent&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);  <span class="comment">// 打印当前线程</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;asyncConcurrent---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.hs.queue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;asyncConcurrent---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">09.998795</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138556</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000ffc740</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">09.998905</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138556</span>] asyncConcurrent---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">09.999027</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138556</span>] asyncConcurrent---end</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">12.004240</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138746</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000fda9c0</span>&gt;&#123;number = <span class="number">8</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">12.004239</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138757</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000ff25c0</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">12.004241</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138747</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000fbc8c0</span>&gt;&#123;number = <span class="number">5</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">14.004538</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138746</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000fda9c0</span>&gt;&#123;number = <span class="number">8</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">14.004538</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138757</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000ff25c0</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">14.004538</span>+<span class="number">0800</span> GCD01[<span class="number">2932</span>:<span class="number">138747</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000fbc8c0</span>&gt;&#123;number = <span class="number">5</span>, name = (null)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 同步执行 + 串行队列</span></span><br><span class="line"><span class="comment"> * 特点：不会开启新线程，在当前线程执行任务。任务是串行的，执行完一个任务，再执行下一个任务。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)syncSerial&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);  <span class="comment">// 打印当前线程</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;syncSerial---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.hs.queue&quot;</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;syncSerial---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">09.812435</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000027003c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">09.812540</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] syncSerial---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">11.812918</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000027003c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">13.813264</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000027003c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">15.814544</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000027003c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">17.814767</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000027003c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">19.815968</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000027003c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">21.816267</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000027003c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">21.816439</span>+<span class="number">0800</span> GCD01[<span class="number">2986</span>:<span class="number">140787</span>] syncSerial---end</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步执行 + 串行队列</span></span><br><span class="line"><span class="comment"> * 特点：会开启一条新线程，但是因为任务是串行的，执行完一个任务，再执行下一个任务。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)asyncSerial&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);  <span class="comment">// 打印当前线程</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;asyncSerial---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.hs.queue&quot;</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;asyncSerial---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">48.440422</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142364</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021843c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">48.440607</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142364</span>] asyncSerial---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">48.440731</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142364</span>] asyncSerial---end</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">50.445911</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142419</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600002199d00</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">52.451231</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142419</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600002199d00</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">54.455630</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142419</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600002199d00</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">56.455855</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142419</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600002199d00</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">48</span>:<span class="number">58.461050</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142419</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600002199d00</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">49</span>:<span class="number">00.463611</span>+<span class="number">0800</span> GCD01[<span class="number">3023</span>:<span class="number">142419</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600002199d00</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 同步执行 + 主队列</span></span><br><span class="line"><span class="comment">* 特点(主线程调用)：互相等待,卡住主线程,造成死锁</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="type">void</span>)syncMain&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);  <span class="comment">// 打印当前线程</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;syncMain---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;syncMain---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">51</span>:<span class="number">57.239288</span>+<span class="number">0800</span> GCD01[<span class="number">3047</span>:<span class="number">144140</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600003c549c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">51</span>:<span class="number">57.239399</span>+<span class="number">0800</span> GCD01[<span class="number">3047</span>:<span class="number">144140</span>] syncMain---begin</span><br><span class="line">(lldb) </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步执行 + 主队列</span></span><br><span class="line"><span class="comment"> * 特点：只在主线程中执行任务，执行完一个任务，再执行下一个任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)asyncMain&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);  <span class="comment">// 打印当前线程</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;asyncMain---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;asyncMain---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">06.334474</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021f4080</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">06.334603</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] asyncMain---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">06.334717</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] asyncMain---end</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">08.351357</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021f4080</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">10.351767</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021f4080</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">12.352891</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021f4080</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">14.353229</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021f4080</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">16.354593</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021f4080</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">18.354813</span>+<span class="number">0800</span> GCD01[<span class="number">3100</span>:<span class="number">147296</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000021f4080</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.2.2**</strong>队列组dispatch_group**</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 队列组 dispatch_group_notify</span></span><br><span class="line"><span class="comment"> *当所有任务都执行完成之后，才执行dispatch_group_notify block 中的任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)qpc_dispatchgroup&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;group---begin&quot;</span>);</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;myqueue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;group---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">46.858071</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150155</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000037681c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">46.858216</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150155</span>] group---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">46.858329</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150155</span>] group---end</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">48.862878</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150280</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x60000372d6c0</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">48.862876</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150281</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x60000372c640</span>&gt;&#123;number = <span class="number">3</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">50.864822</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150280</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x60000372d6c0</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">50.864823</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150281</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x60000372c640</span>&gt;&#123;number = <span class="number">3</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">52.865242</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150155</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000037681c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">54.865686</span>+<span class="number">0800</span> GCD01[<span class="number">3146</span>:<span class="number">150155</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000037681c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 队列组 dispatch_group_wait</span></span><br><span class="line"><span class="comment"> *当所有任务执行完成之后，才执行 dispatch_group_wait 之后的操作,会阻塞当前线程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)groupWait&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;group---begin&quot;</span>);</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;myqueue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;group---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">41.868091</span>+<span class="number">0800</span> GCD01[<span class="number">3187</span>:<span class="number">153758</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000030e4140</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">41.868220</span>+<span class="number">0800</span> GCD01[<span class="number">3187</span>:<span class="number">153758</span>] group---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">43.873508</span>+<span class="number">0800</span> GCD01[<span class="number">3187</span>:<span class="number">153883</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000030de980</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">43.873508</span>+<span class="number">0800</span> GCD01[<span class="number">3187</span>:<span class="number">153881</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000030d7a80</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">45.875594</span>+<span class="number">0800</span> GCD01[<span class="number">3187</span>:<span class="number">153881</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000030d7a80</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">45.875594</span>+<span class="number">0800</span> GCD01[<span class="number">3187</span>:<span class="number">153883</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000030de980</span>&gt;&#123;number = <span class="number">6</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">45.875811</span>+<span class="number">0800</span> GCD01[<span class="number">3187</span>:<span class="number">153758</span>] group---end</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 队列组 dispatch_group_enter、dispatch_group_leave</span></span><br><span class="line"><span class="comment"> *当所有任务执行完成之后，才执行 dispatch_group_notify 中的任务。这里的dispatch_group_enter、dispatch_group_leave组合，其实等同于dispatch_group_async</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)groupEnterAndLeave&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;group---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">    dispatch_group_enter(group);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_group_leave(group);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_enter(group);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_group_leave(group);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="comment">// 等前面的异步操作都执行完毕后，回到主线程.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;group---end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">13.875926</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157677</span>] currentThread---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000e807c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">13.876043</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157677</span>] group---begin</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">13.876179</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157677</span>] group---end</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">15.876440</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157767</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000ec5740</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">15.876486</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157765</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000ec8600</span>&gt;&#123;number = <span class="number">8</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">17.881362</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157767</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000ec5740</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">17.881362</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157765</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000ec8600</span>&gt;&#123;number = <span class="number">8</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">19.882660</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157677</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000e807c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-19</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">21.883995</span>+<span class="number">0800</span> GCD01[<span class="number">3252</span>:<span class="number">157677</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000e807c0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br></pre></td></tr></table></figure>



<p><strong>2.2.3**</strong>dispatch_barrier_async 栅栏方法**</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 栅栏方法 dispatch_barrier_async</span></span><br><span class="line"><span class="comment"> * 执行完栅栏前面的操作之后，才执行栅栏操作，最后再执行栅栏后边的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)barrier&#123;</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.hs.dome&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_barrier_async(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;barrier---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;4---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.2.4**</strong>dispatch_semaphore 信号量**</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * semaphore 线程同步</span></span><br><span class="line"><span class="comment"> * 将异步执行任务转换为同步执行任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)semaphoreSync&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;semaphore---begin&quot;</span>);</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">0</span>);</span><br><span class="line">    __block <span class="type">int</span> number = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        </span><br><span class="line">        number = <span class="number">100</span>;</span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;semaphore---end,number = %d&quot;</span>,number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三-NSOperation"><a href="#三-NSOperation" class="headerlink" title="三 NSOperation"></a>三 NSOperation</h3><p><strong>3.1.1 NSOperation、NSOperationQueue 使用步骤</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 addOperationWithBlock: 将操作加入到操作队列中</span></span><br><span class="line"><span class="comment"> * 将操作加入到操作队列后能够开启新线程，进行并发执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)addOperationWithBlockToQueue&#123;</span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;4---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.1.2</strong> <strong>控制串行执行、并发执行</strong></p>
<p>maxConcurrentOperationCount 控制的不是并发线程的数量，而是一个队列中同时能并发执行的最大操作数</p>
<ul>
<li>maxConcurrentOperationCount 默认情况下为-1，表示不进行限制，可进行并发执行。</li>
<li>maxConcurrentOperationCount 为1时，队列为串行队列。只能串行执行。</li>
<li>maxConcurrentOperationCount 大于1时，队列为并发队列。操作并发执行，当然这个值不应超过系统限制</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置 MaxConcurrentOperationCount（最大并发操作数）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)addOperationWithBlockToQueue&#123;</span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    queue.maxConcurrentOperationCount = <span class="number">1</span>;<span class="comment">//串行执行</span></span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;4---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结:</strong></p>
<p>当最大并发操作数为1时，操作是按顺序串行执行的，并且一个操作完成之后，下一个操作才开始执行。当最大操作并发数为2时，操作是并发执行的，可以同时执行两个操作。而开启线程数量是由系统决定的，不需要我们来管理。</p>
<p><strong>3.1.3</strong> <strong>addDependency操作依赖</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)addDependency&#123;</span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op2 addDependency:op1];<span class="comment">// 让op2 依赖于 op1，则先执行op1，在执行op2</span></span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">&#125;</span><br><span class="line">打印结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">21</span>:<span class="number">40.251808</span>+<span class="number">0800</span> GCD01[<span class="number">4133</span>:<span class="number">192904</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600003adad80</span>&gt;&#123;number = <span class="number">5</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">21</span>:<span class="number">42.252554</span>+<span class="number">0800</span> GCD01[<span class="number">4133</span>:<span class="number">192904</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600003adad80</span>&gt;&#123;number = <span class="number">5</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">21</span>:<span class="number">44.257346</span>+<span class="number">0800</span> GCD01[<span class="number">4133</span>:<span class="number">192903</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600003ad29c0</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">21</span>:<span class="number">46.257638</span>+<span class="number">0800</span> GCD01[<span class="number">4133</span>:<span class="number">192903</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600003ad29c0</span>&gt;&#123;number = <span class="number">7</span>, name = (null)&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.1.4</strong> <strong>NSOperation 优先级</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 优先级的取值</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSOperationQueuePriority</span>) &#123;</span><br><span class="line">    <span class="built_in">NSOperationQueuePriorityVeryLow</span> = <span class="number">-8</span>L,</span><br><span class="line">    <span class="built_in">NSOperationQueuePriorityLow</span> = <span class="number">-4</span>L,</span><br><span class="line">    <span class="built_in">NSOperationQueuePriorityNormal</span> = <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">NSOperationQueuePriorityHigh</span> = <span class="number">4</span>,</span><br><span class="line">    <span class="built_in">NSOperationQueuePriorityVeryHigh</span> = <span class="number">8</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>设置优先级后并没有达到想要的效果,该属性还待解答.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)addDependency_queuePriority&#123;</span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task1) object:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task2) object:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op3 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task3) object:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op4 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task4) object:<span class="literal">nil</span>];</span><br><span class="line">    op4.queuePriority = <span class="built_in">NSOperationQueuePriorityVeryHigh</span>;</span><br><span class="line">    op1.queuePriority = <span class="built_in">NSOperationQueuePriorityLow</span>;</span><br><span class="line">    </span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">    [queue addOperation:op3];</span><br><span class="line">    [queue addOperation:op4];</span><br><span class="line">&#125;</span><br><span class="line">打印结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">48.168577</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208620</span>] <span class="number">4</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000004729c0</span>&gt;&#123;number = <span class="number">4</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">48.168580</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208625</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000466000</span>&gt;&#123;number = <span class="number">3</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">48.168581</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208622</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000457a40</span>&gt;&#123;number = <span class="number">5</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">48.168577</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208626</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000465880</span>&gt;&#123;number = <span class="number">8</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">50.173404</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208622</span>] <span class="number">2</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000457a40</span>&gt;&#123;number = <span class="number">5</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">50.173404</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208626</span>] <span class="number">3</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000465880</span>&gt;&#123;number = <span class="number">8</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">50.173404</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208625</span>] <span class="number">1</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x600000466000</span>&gt;&#123;number = <span class="number">3</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">50.173404</span>+<span class="number">0800</span> GCD01[<span class="number">4346</span>:<span class="number">208620</span>] <span class="number">4</span>---&lt;<span class="built_in">NSThread</span>: <span class="number">0x6000004729c0</span>&gt;&#123;number = <span class="number">4</span>, name = (null)&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.1.4</strong> <strong>NSOperation线程间通信</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线程间通信</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)communication&#123;</span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回主线程</span></span><br><span class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="四-多线程安全隐患-线程同步"><a href="#四-多线程安全隐患-线程同步" class="headerlink" title="四 多线程安全隐患-线程同步"></a>四 多线程安全隐患-线程同步</h3><p>常见的线程同步技术:加锁</p>
<p>iOS常见加锁方案</p>
<ul>
<li>OSSpinLock </li>
<li>os_unfair_lock </li>
<li>pthread_mutex </li>
<li>dispatch_semaphore </li>
<li>dispatch_queue(DISPATCH_QUEUE_SERIAL) </li>
<li>NSLock </li>
<li>NSRecursiveLock </li>
<li>NSCondition</li>
<li>NSConditionLock </li>
<li>@synchronized </li>
</ul>
<p><strong>4.1</strong> <strong>OSSpinLock</strong> </p>
<p>OSSpinLock叫做”自旋锁”，等待锁的线程会处于忙等（busy-wait）状态，一直占用着CPU资源</p>
<p>目前已经不再安全，可能会出现优先级反转问题</p>
<p>如果等待锁的线程优先级较高，它会一直占用着CPU资源，优先级低的线程就无法释放锁</p>
<p>需要导入头文件#import &lt;libkern/OSAtomic.h&gt;</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808172804-ece31806-2815-4687-8cbb-c295ffb2185f.png" alt="img"></p>
<p><strong>4.2</strong> <strong>os_unfair_lock</strong> </p>
<p>os_unfair_lock用于取代不安全的OSSpinLock ，从iOS10开始才支持</p>
<p>从底层调用看，等待os_unfair_lock锁的线程会处于休眠状态，并非忙等</p>
<p>需要导入头文件#import &lt;os/lock.h&gt;</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808217632-d5ea0bcf-7a6c-4877-b3d9-cc8f53d7dd87.png" alt="img"></p>
<p><strong>4.3</strong> <strong>pthread_mutex (normal)</strong></p>
<p>mutex叫做”互斥锁”，等待锁的线程会处于休眠状态</p>
<p>需要导入头文件#import &lt;pthread.h&gt;</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808256309-02287254-a7d0-4c38-86dc-fe580f1718fa.png" alt="img"></p>
<p><strong>4.4</strong> <strong>pthread_mutex (recursive) 递归锁</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808393628-05b9c169-6b9d-45c4-ab31-9c4dde9636b8.png" alt="img"></p>
<p><strong>4.5</strong> <strong>pthread_mutex (condition) 条件</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808457775-d01fb755-225f-4533-a31a-e62060a9ebda.png" alt="img"></p>
<p><strong>4.6 NSLock/NSRecursiveLock</strong></p>
<p>NSLock是对mutex普通锁的封装 </p>
<p>NSRecursiveLock也是对mutex递归锁的封装，API跟NSLock基本一致</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808553923-17972075-87d2-472b-b325-748a86dfc748.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808560714-f9d27f8a-204d-40ab-8904-ddfee654f02d.png" alt="img"></p>
<p><strong>4.7 NSCondition</strong></p>
<p>NSCondition是对mutex和cond的封装 </p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808616416-1c62d75f-a76f-4e8d-b81e-795156d61fee.png" alt="img"></p>
<p><strong>4.8</strong> <strong>NSConditionLock</strong></p>
<p>NSConditionLock是对NSCondition的进一步封装，可以设置具体的条件值 </p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808669285-0eabeac9-f56f-47b5-bcfa-8d7d70cb8518.png" alt="img"></p>
<p><strong>4.9 dispatch_semaphore</strong></p>
<p>semaphore叫做”信号量” </p>
<p>信号量的初始值，可以用来控制线程并发访问的最大数量 </p>
<p>信号量的初始值为1，代表同时只允许1条线程访问资源，保证线程同步 </p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808751508-578e82ef-507b-4af9-a5c7-8767318f3205.png" alt="img"></p>
<p><strong>4.10 GCD串行队列</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808816084-7ab01211-b556-4fb9-b3a3-14ea6a0e7223.png" alt="img"></p>
<p><strong>4.11 @synchronized</strong> </p>
<p>@synchronized是对mutex递归锁的封装 </p>
<p>@synchronized(obj)内部会生成obj对应的递归锁，然后进行加锁、解锁操作</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/668117/1613808875201-5177f3ca-662a-48dd-9b1b-4111c5107ad5.png" alt="img"></p>
<p><strong>4.2 线程同步性能比较</strong></p>
<p>性能从高到低排序 </p>
<ol>
<li>os_unfair_lock </li>
<li>OSSpinLock </li>
<li>dispatch_semaphore </li>
<li>pthread_mutex </li>
<li>dispatch_queue(DISPATCH_QUEUE_SERIAL) </li>
<li>NSLock </li>
<li>NSCondition </li>
<li>pthread_mutex(recursive) </li>
<li>NSRecursiveLock </li>
<li>NSConditionLock </li>
<li>@synchronized</li>
</ol>
<h3 id="五-读写方案-多读单写"><a href="#五-读写方案-多读单写" class="headerlink" title="五 读写方案 (多读单写)"></a>五 读写方案 (多读单写)</h3><ul>
<li>同一时间，只能有1个线程进行写的操作</li>
<li>同一时间，允许多个线程进行读的操作</li>
<li>同一时间，不允许既有写的操作，又有读的操作</li>
</ul>
<p>现有解决方案:</p>
<ol>
<li>pthread_rwlock：读写锁</li>
<li>dispatch_barrier_async：异步栅栏调用</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    pthread_rwlock_init(&amp;_lock, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">            [<span class="keyword">self</span> read];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">            [<span class="keyword">self</span> write];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)read&#123;</span><br><span class="line">    pthread_rwlock_rdlock(&amp;_lock);</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    pthread_rwlock_unlock(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)write&#123;</span><br><span class="line">    pthread_rwlock_wrlock(&amp;_lock);</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    pthread_rwlock_unlock(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pthread_rwlock_destroy 是pthread锁，要销毁</span></span><br><span class="line">- (<span class="type">void</span>)dealloc&#123;</span><br><span class="line">    pthread_rwlock_destroy(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">打印结果:</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">56.110128</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232022</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">56.110128</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232025</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">57.115415</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232023</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">58.117225</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232024</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">59.119190</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232026</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">00.121009</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232028</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">01.123432</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232030</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">02.127358</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232031</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">03.130017</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232032</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">04.133641</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232033</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">05.134574</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232034</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">06.136287</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232035</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">07.139924</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232036</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">08.144879</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232037</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">09.150167</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232038</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">10.153798</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232039</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">11.158837</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232040</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">12.161323</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232041</span>] -[ViewController write]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">13.165552</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232042</span>] -[ViewController read]</span><br><span class="line"><span class="number">2021</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">14.169961</span>+<span class="number">0800</span> GCD01[<span class="number">4628</span>:<span class="number">232043</span>] -[ViewController write]</span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.queue = dispatch_queue_create(<span class="string">&quot;rw_queue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(_queue, ^&#123;</span><br><span class="line">            [<span class="keyword">self</span> read];</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">dispatch_async</span>(_queue, ^&#123;</span><br><span class="line">            [<span class="keyword">self</span> read];</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">dispatch_async</span>(_queue, ^&#123;</span><br><span class="line">            [<span class="keyword">self</span> read];</span><br><span class="line">        &#125;);</span><br><span class="line">        dispatch_barrier_sync(<span class="keyword">self</span>.queue, ^&#123;</span><br><span class="line">            [<span class="keyword">self</span> write];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)read&#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)write&#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>iOS多线程</p><p><a href="https://qpc2015.github.io/2020/07/02/iOS多线程/">https://qpc2015.github.io/2020/07/02/iOS多线程/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>覃鹏成</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-07-02</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-07-04</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/iOS/">iOS</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/07/02/OC%E4%B8%8EJS%E4%BA%A4%E4%BA%92/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">OC与JS交互</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/07/01/%E8%AF%BB-%E5%9B%BE%E8%A7%A3%E7%89%A9%E8%81%94%E7%BD%91/"><span class="level-item">读&lt;&lt;图解物联网&gt;&gt;</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="SOHUCS" sid="2020/07/02/iOS多线程/"></div><script charset="utf-8" src="https://changyan.sohu.com/upload/changyan.js"></script><script>window.changyan.api.config({appid: 'cyw2jbP3v',conf: 'prod_84816b763e4a00b5ad4eca58f742355f'});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="鹏成的博客"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">鹏成的博客</p><p class="is-size-6 is-block">鹏成的博客</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>上海浦东</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">34</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">21</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/qpc2015" target="_blank" rel="noopener">关注我</a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="http://www.wellfruit.net" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">well</span></span><span class="level-right"><span class="level-item tag">www.wellfruit.net</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/flutter-%E7%A7%BB%E5%8A%A8%E7%AB%AF/"><span class="level-start"><span class="level-item">flutter 移动端</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/iOS/"><span class="level-start"><span class="level-item">iOS</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/swift/"><span class="level-start"><span class="level-item">swift</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%85%B6%E4%BB%96/"><span class="level-start"><span class="level-item">其他</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="level-start"><span class="level-item">数据结构</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%89%A9%E8%81%94%E7%BD%91/"><span class="level-start"><span class="level-item">物联网</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-04T03:07:39.000Z">2022-07-04</time></p><p class="title"><a href="/2022/07/04/App-Store-Connect%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E6%97%A0%E6%95%88/">App Store Connect二进制文件无效</a></p><p class="categories"><a href="/categories/iOS/">iOS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-01T02:24:14.000Z">2022-07-01</time></p><p class="title"><a href="/2022/07/01/iOS%E7%BB%99iot%E8%AE%BE%E5%A4%87%E9%85%8D%E7%BD%91/">iOS给iot设备配网</a></p><p class="categories"><a href="/categories/iOS/">iOS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-06-24T06:41:53.000Z">2022-06-24</time></p><p class="title"><a href="/2022/06/24/iOS%E4%B8%8E%E7%A1%AC%E4%BB%B6%E6%89%93%E4%BA%A4%E9%81%93-NSMutableData-NSData-Byte%E7%9A%84%E4%BD%BF%E7%94%A8/">iOS与硬件打交道-NSMutableData NSData Byte的使用</a></p><p class="categories"><a href="/categories/iOS/">iOS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-06-23T06:14:59.000Z">2022-06-23</time></p><p class="title"><a href="/2022/06/23/WIFI%E9%85%8D%E7%BD%91%E6%96%B9%E6%A1%88/">WIFI配网方案</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-04-22T04:16:37.000Z">2022-04-22</time></p><p class="title"><a href="/2022/04/22/Node%E7%AC%94%E8%AE%B0/">Node笔记</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AFNetworking/"><span class="tag">AFNetworking</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ES6/"><span class="tag">ES6</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Markdown/"><span class="tag">Markdown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NSData-Byte/"><span class="tag">NSData Byte</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React/"><span class="tag">React</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/crash/"><span class="tag">crash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo%E5%8D%9A%E5%AE%A2/"><span class="tag">hexo博客</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS%E9%80%86%E5%90%91/"><span class="tag">iOS逆向</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vue/"><span class="tag">vue</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%B2/"><span class="tag">串</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"><span class="tag">小程序</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"><span class="tag">微信小程序</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%A0%88/"><span class="tag">栈</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%A0%91/"><span class="tag">树</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%89%A9%E8%81%94%E7%BD%91/"><span class="tag">物联网</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/"><span class="tag">线性表</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%98%9F%E5%88%97/"><span class="tag">队列</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="覃鹏成的博客" height="28"></a><p class="is-size-7"><span>&copy; 2022 覃鹏成</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>